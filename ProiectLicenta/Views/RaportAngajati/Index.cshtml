@using ProiectLicenta.ViewModels
@model IEnumerable<RaportAngajati>
@{
    ViewData["Title"] = "Raport Angajati";
    string currentSort = ViewBag.SortOrder != null ? ViewBag.SortOrder : "";
    int angajatSelectat = ViewBag.AngajatSelectata != null ? (int)ViewBag.AngajatSelectata : 0;
    string registruSelectat = ViewBag.RegistruSelectat as string;
}
<h1 class="fw-bold pb-2 pb-xl-3 text-center"><i class="bi bi-card-list"></i> Raport Angajati</h1>
<div>
    <a class="btn btn-warning me-3" href="@Url.Action("Index", "Home")"><i class="bi bi-arrow-left"></i> Inapoi</a>
    <form method="get" action="@Url.Action("Index")">
        <div class="form-group mt-3 mb-3">
            <select class="form-select form-control-lg" name="angajatSelectat" asp-items="ViewBag.Angajati">
                <option value="0" hidden>Alege Angajat</option>
            </select>
        </div>
        <div class="form-group mb-3">
            <select class="form-select form-control-lg" name="registruSelectat" asp-items="ViewBag.Registre">
                <option value="0" hidden>Alege Registru</option>
            </select>
        </div>
        <input class="btn btn-primary mb-3" type="submit" value="Generare Raport" />
    </form>
    @if (Model != null && Model.Any())
    {
        <h2 class="mt-4 text-center">Rezultate</h2>
        @foreach (var item in Model)
        {
            <table class="table">
                <tr>
                    <td>Nume: @item.Nume @item.Prenume</td>
                    <td>Functie: @item.Functie</td>
                </tr>
            </table>
            @if (item.RegistruCopilire != null && item.RegistruCopilire.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Copilire</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Copilire
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodCopilire" ? "CodCopilire_desc" : "CodCopilire" })">
                                    @if (currentSort != "CodCopilire_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Numar Plante
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "NumarPlante" ? "NumarPlante_desc" : "NumarPlante" })">
                                    @if (currentSort != "NumarPlante_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Copilire
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataCopilire" ? "DataCopilire_desc" : "DataCopilire" })">
                                    @if (currentSort != "DataCopilire_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruCopilire)
                        {
                            total += @registru.NumarPlante;
                            <tr>
                                <td>@registru.CodCopilire</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.NumarPlante</td>
                                <td>@registru.DataCopilire.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td>Total Plante</td>
                    <td>@total</td>
                    <td></td>
                    </tbody>
                </table>
            }
            @if (item.RegistruFertilizare != null && item.RegistruFertilizare.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Fertilizare</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Fertilizare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodFertilizare" ? "CodFertilizare_desc" : "CodFertilizare" })">
                                    @if (currentSort != "CodFertilizare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Suprafata
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "Suprafata" ? "Suprafata_desc" : "Suprafata" })">
                                    @if (currentSort != "Suprafata_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Fertilizare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataFertilizare" ? "DataFertilizare_desc" : "DataFertilizare" })">
                                    @if (currentSort != "DataFertilizare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruFertilizare)
                        {
                            total += @registru.Suprafata;
                            <tr>
                                <td>@registru.CodFertilizare</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.Suprafata &#x33A1;</td>
                                <td>@registru.DataFertilizare.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td>Total Suprafata</td>
                    <td>@total &#x33A1;</td>
                    <td></td>
                    </tbody>
                </table>
            }
            @if (item.RegistruIrigare != null && item.RegistruIrigare.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Irigare</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Irigare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodIrigare" ? "CodIrigare_desc" : "CodIrigare" })">
                                    @if (currentSort != "CodIrigare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Durata Irigare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DurataIrigare" ? "DurataIrigare_desc" : "DurataIrigare" })">
                                    @if (currentSort != "DurataIrigare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Irigare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataIrigare" ? "DataIrigare_desc" : "DataIrigare" })">
                                    @if (currentSort != "DataIrigare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruIrigare)
                        {
                            total += registru.DurataIrigare;
                            <tr>
                                <td>@registru.CodIrigare</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.DurataIrigare</td>
                                <td>@registru.DataIrigare.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td>Total Durata</td>
                    <td>@total</td>
                    <td></td>
                    </tbody>
                </table>
            }
            @if (item.RegistruPalisare != null && item.RegistruPalisare.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Palisare</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Palisare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodPalisare" ? "CodPalisare_desc" : "CodPalisare" })">
                                    @if (currentSort != "CodPalisare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Numar Plante
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "NumarPlante" ? "NumarPlante_desc" : "NumarPlante" })">
                                    @if (currentSort != "NumarPlante_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Palisare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataPalisare" ? "DataPalisare_desc" : "DataPalisare" })">
                                    @if (currentSort != "DataPalisare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruPalisare)
                        {
                            total += @registru.NumarPlante;
                            <tr>
                                <td>@registru.CodPalisare</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.NumarPlante</td>
                                <td>@registru.DataPalisare.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td>Total Plante</td>
                    <td>@total</td>
                    <td></td>
                    </tbody>
                </table>
            }
            @if (item.RegistruRecoltare != null && item.RegistruRecoltare.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Recoltare</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Recoltare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodRecoltare" ? "CodRecoltare_desc" : "CodRecoltare" })">
                                    @if (currentSort != "CodRecoltare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Cantitate Recoltata
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CantitateRecoltata" ? "CantitateRecoltata_desc" : "CantitateRecoltata" })">
                                    @if (currentSort != "CantitateRecoltata_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Recoltare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataRecoltare" ? "DataRecoltare_desc" : "DataRecoltare" })">
                                    @if (currentSort != "DataRecoltare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruRecoltare)
                        {
                            total += registru.CantitateRecoltata;
                            <tr>
                                <td>@registru.CodRecoltare</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.CantitateRecoltata</td>
                                <td>@registru.DataRecoltare.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td>Total Recoltat</td>
                    <td>@total</td>
                    <td></td>
                    </tbody>
                </table>
            }
            @if (item.RegistruTratamente != null && item.RegistruTratamente.Any())
            {
                int total = 0;
                <table class="table table-striped table-bordered">
                    <h4 class="mt-4 text-center">Registru Tratamente</h4>
                    <thead>
                        <tr>
                            <th>
                                Cod Tratament Aplicat
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodTratamentAplicat" ? "CodTratamentAplicat_desc" : "CodTratamentAplicat" })">
                                    @if (currentSort != "CodTratamentAplicat_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Parcela
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodParcela" ? "CodParcela_desc" : "CodParcela" })">
                                    @if (currentSort != "CodParcela_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Daunator
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "CodDaunator" ? "CodDaunator_desc" : "CodDaunator" })">
                                    @if (currentSort != "CodDaunator_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Tratament
                            </th>
                            <th>
                                Suprafata
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "Suprafata" ? "Suprafata_desc" : "Suprafata" })">
                                    @if (currentSort != "Suprafata_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                            <th>
                                Data Aplicare
                                <a href="@Url.Action("Index", new { angajatSelectat, registruSelectat, sortOrder = currentSort == "DataAplicare" ? "DataAplicare_desc" : "DataAplicare" })">
                                    @if (currentSort != "DataAplicare_desc")
                                    {
                                        <i class="bi bi-sort-up"></i>
                                    }
                                    else
                                    {
                                        <i class="bi bi-sort-down"></i>
                                    }
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registru in item.RegistruTratamente)
                        {
                            total += registru.Suprafata;
                            <tr>
                                <td>@registru.CodTratamentAplicat</td>
                                <td>@registru.CodParcela - @registru.Parcela.Locatie</td>
                                <td>@registru.Daunatori.Denumire</td>
                                <td>@registru.Daunatori.Tratament.Denumire</td>
                                <td>@registru.Suprafata &#x33A1;</td>
                                <td>@registru.DataAplicare.ToString("dd/MM/yyyy")</td>
                            </tr>
                        }
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Total Suprafata</td>
                    <td>@total &#x33A1;</td>
                    <td></td>
                    </tbody>
                </table>
            }
        }
    }
    else
    {
        <p>Nu exista date.</p>
    }
</div>
